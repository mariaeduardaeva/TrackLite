<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="TrackLite.HistoricoPage"
             BackgroundColor="#F2F2F2"
             Title="Histórico">

    <!-- Toolbar -->
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Lixo"
                     IconImageSource="lixo_p.png"
                     Order="Primary"
                     Priority="0"
                     Clicked="OnLixoClicked" />
    </ContentPage.ToolbarItems>

    <!-- CollectionView de Corridas Agrupadas -->
    <CollectionView x:Name="CorridasCollectionView"
                    ItemsSource="{Binding CorridasAgrupadas}"
                    IsGrouped="True"
                    SelectionMode="None"
                    Margin="15,10">

        <!-- Cabeçalho do Grupo (Data) -->
        <CollectionView.GroupHeaderTemplate>
            <DataTemplate>
                <Label Text="{Binding DataChave}" 
                       FontSize="14"
                       TextColor="#848484"
                       Margin="0,15,0,5"/>
            </DataTemplate>
        </CollectionView.GroupHeaderTemplate>

        <!-- Template das corridas -->
        <CollectionView.ItemTemplate>
            <DataTemplate>
                <SwipeView>
                    <!-- Swipe para remover corridas -->
                    <SwipeView.RightItems>
                        <SwipeItems Mode="Execute">
                            <SwipeItemView Invoked="OnSwipeItemInvoked">
                                <Frame CornerRadius="17"
                                       BackgroundColor="red"
                                       Padding="10"
                                       Margin="5"
                                       HasShadow="False">
                                    <StackLayout Orientation="Horizontal"
                                                 VerticalOptions="Center"
                                                 HorizontalOptions="Center">
                                        <Image Source="lixo.png"
                                               WidthRequest="20"
                                               HeightRequest="20"/>
                                        <Label Text="Excluir"
                                               TextColor="White"
                                               FontAttributes="Bold"
                                               VerticalOptions="Center"
                                               Margin="5,0,0,0"/>
                                    </StackLayout>
                                </Frame>
                            </SwipeItemView>
                        </SwipeItems>
                    </SwipeView.RightItems>

                    <Frame BackgroundColor="#FCFCFC"
                           CornerRadius="15"
                           HasShadow="False"
                           Padding="10"
                           Margin="0,5">

                        <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto" 
                              RowDefinitions="Auto,Auto" 
                              VerticalOptions="Center" 
                              ColumnSpacing="10"
                              Padding="5">
                            <Image Source="objective.png" 
                                   Grid.RowSpan="2" 
                                   Grid.Column="0"
                                   WidthRequest="21" 
                                   HeightRequest="21"
                                   VerticalOptions="Center"/>

                            <!-- Cabeçalho -->
                            <Label Text="Distância" 
                                   Grid.Row="0" 
                                   Grid.Column="1"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="#214F4B"/>
                            <Label Text="Pace" Grid.Row="0" 
                                   Grid.Column="2"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="#214F4B"/>

                            <!-- Valores das Corridas -->
                            <Label Text="{Binding Distancia}" 
                                   Grid.Row="1" 
                                   Grid.Column="1"
                                   FontSize="16"
                                   TextColor="black"/>
                            <Label Text="{Binding Ritmo}" 
                                   Grid.Row="1" 
                                   Grid.Column="2"
                                   FontSize="16"
                                   TextColor="black"/>

                            <!-- Horário da Corrida -->
                            <Label Text="{Binding Data, StringFormat='{0:HH:mm}'}" 
                                   Grid.RowSpan="2" 
                                   Grid.Column="3"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="#214F4B"
                                   VerticalOptions="Center"
                                   HorizontalOptions="End"/>

                            <Image Source="clock.png" 
                                   Grid.RowSpan="2" 
                                   Grid.Column="4"
                                   WidthRequest="21" 
                                   HeightRequest="21"
                                   VerticalOptions="Center"/>
                        </Grid>

                        <!-- Comando ao clicar na corrida -->
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer 
                                Command="{Binding Source={x:Reference CorridasCollectionView}, Path=BindingContext.ItemTappedCommand}"
                                CommandParameter="{Binding .}" />
                        </Frame.GestureRecognizers>
                    </Frame>
                </SwipeView>
            </DataTemplate>
        </CollectionView.ItemTemplate>
    </CollectionView>
</ContentPage>
